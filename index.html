<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공공데이터기업매칭_위도경도찍기</title>
    <style>
        #result{
            width: 100px;
            height: 65px;
            display: inline-block;
            border: 0.5px;
        }
        input{
            display: inline-block;
        }
        table{
            width: 30%;
            border: 1px solid #444444;
            border-collapse: collapse;
        }
        tr, td{
            border: 0.6px solid #444444;
            padding: 3px;
        }
    </style>
</head>
<body>
    <div id="menu_wrap">
        <div class="option">
            <div>
                <form onsubmit="searchPlaces(); return false;">
                    <input type="text" value="" id="keyword" size="30"> 
                    <button type="submit">검색하기</button> 
                </form>
            </div>
        </div>
        <hr>
        <ul id="placesList"></ul>
        <div id="pagination"></div>
    </div>
    <div id="map" style="width:100vw;height:350px;"></div>
    <p><em>지도를 움직여주세요!</em></p> 
    <div id="result"></div> <!--좌표가 표시되는 영역-->
    
    <input type='button' 
            value='좌표 저장' 
            onclick='addRow()'/>

    <hr>
    <table id='location' border="0.01" style="width:60vw;">
        <thead>
            <tr><th>순서</th><th>좌표</th></tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <input type='button' 
            value='마지막 줄 삭제' 
            onclick='deleteRow(-1)' />



    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=2fdabf3cc0a47373d8483c7417adf582&libraries=services"></script>
    <script>

        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
        mapOption = { 
            center: new kakao.maps.LatLng(37.411215, 127.128679), // 지도의 중심좌표
            level: 3 // 지도의 확대 레벨
        };

        
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 지도를 클릭한 위치에 표출할 마커
        var marker = new kakao.maps.Marker({ 
            // 지도 중심좌표에 마커를 생성 
            position: map.getCenter() 
        }); 
        // 지도에 마커를 표시
        marker.setMap(map);


        // 장소 검색 객체를 생성
        var ps = new kakao.maps.services.Places(); 

        var infowindow = new kakao.maps.InfoWindow({zIndex:1});

        // 키워드로 장소를 검색
        searchPlaces();

        // 키워드 검색을 요청하는 함수
        function searchPlaces() {

            var keyword = document.getElementById('keyword').value;

            //if (!keyword.replace(/^\s+|\s+$/g, '')) {
            //    alert('장소를 입력해주세요!');
            //    return false;
            //}

            // 장소검색 객체를 통해 키워드로 장소검색을 요청
            ps.keywordSearch( keyword, placesSearchCB); 
        }



        // 키워드 검색 완료 시 호출되는 콜백함수
        function placesSearchCB (data, status, pagination) {
            if (status === kakao.maps.services.Status.OK) {

                // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
                // LatLngBounds 객체에 좌표를 추가
                var bounds = new kakao.maps.LatLngBounds();

                for (var i=0; i<data.length; i++) {
                    displayMarker(data[i]);    
                    bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
                }       

                // 검색된 장소 위치를 기준으로 지도 범위를 재설정
                map.setBounds(bounds);
            } 
        }

        // 지도에 마커를 표시하는 함수
        function displayMarker(place) {
            
            // 마커를 생성하고 지도에 표시
            var marker = new kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(place.y, place.x) 
            });

            // 마커에 클릭이벤트를 등록
            kakao.maps.event.addListener(marker, 'click', function() {
                infowindow.setContent('<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>');
                infowindow.open(map, marker);
            });
        }

        
        // 지도 중심좌표가 변경되면 마지막 파라미터로 넘어온 함수를 호출하도록 하는 이벤트를 등록
        kakao.maps.event.addListener(map, 'center_changed', function() {

        var level = map.getLevel();

        var latlng = map.getCenter(); 
        
        marker.setPosition(latlng);

        var message = '위도&경도' + '<br>'+ latlng.getLat().toFixed(6) + '<br>';
            message += latlng.getLng().toFixed(6);

        var resultDiv = document.getElementById('result');
        resultDiv.innerHTML = message;

        });

        var count = 0;
        
        function addRow() {
        // table element 찾기
        const table = document.getElementById('location');
        
        // 새 행(Row) 추가
        const newRow = table.insertRow();
        
        // 새 행(Row)에 Cell 추가
        const newCell1 = newRow.insertCell(0);
        const newCell2 = newRow.insertCell(1);
        
        count = count + 1;
        var locationDiv = document.getElementById('result');
        var location1 = locationDiv.innerHTML.substring(13, 22);
        var location2 = locationDiv.innerHTML.substring(26, 36);
        // Cell에 텍스트 추가
        newCell1.innerText = count;
        newCell2.innerText = location1 + " / " + location2;
        }

        function deleteRow(rownum) {
        // table element 찾기
        const table = document.getElementById('location');
        
        // 행(Row) 삭제
        const newRow = table.deleteRow(rownum);

        count = count - 1;
        }
    </script>
</body>
</html>
